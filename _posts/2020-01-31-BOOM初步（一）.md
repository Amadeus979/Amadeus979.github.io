---
layout:     post
title:      Verilator从源代码安装
subtitle:   ubuntu-20.04.1
date:       2020-01-31
author:     BY, Amadeus979
header-img: img/post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - Blog
---

由于上一个博客中非常SB地从源码安装了Verilator的Stable版本，因此：

env.sh中只有：

```shell
# line auto-generated by init-submodules-no-riscv-tools.sh
__DIR="$(dirname "$(readlink -f "${BASH_SOURCE[0]:-${(%):-%x}}")")"
PATH=$__DIR/bin:$PATH
PATH=$__DIR/software/firemarshal:$PATH               
```

make时：

```shell
xry@BettyRay:~/Project/BOOM/Learning/chipyard/sims/verilator$ make CONFIG=RocketConfig
/home/xry/Project/BOOM/Learning/chipyard/common.mk:7: *** RISCV is unset. You must set RISCV yourself, or through the Chipyard auto-generated env file.  Stop.
```

我检查verilator发现并没有异常。

```shell
xry@BettyRay:/usr/bin$ ll verilator
-rwxr-xr-x 1 root root 202760 Feb 10  2020 verilator*
xry@BettyRay:/usr/bin$ verilator --version
Verilator 4.108 2021-01-10 rev v4.108-14-g2075db3d
xry@BettyRay:/usr/bin$ $VERILATOR_ROOT/bin/verilator --version
Verilator 4.108 2021-01-10 rev v4.108-14-g2075db3d
```

最后因为陆俊峰学长曾经在群里说的环境的脚本一键安装，看到了`./scripts/ubuntu-req.sh`中有如下内容：

```shell
#!/bin/bash

set -ex

sudo apt-get install -y build-essential bison flex
sudo apt-get install -y libgmp-dev libmpfr-dev libmpc-dev zlib1g-dev vim git default-jdk default-jre
# install sbt: https://www.scala-sbt.org/release/docs/Installing-sbt-on-Linux.html
echo "deb https://dl.bintray.com/sbt/debian /" | sudo tee -a /etc/apt/sources.list.d/sbt.list
curl -sL "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x2EE0EA64E40A89B84B2DF73499E82A75642AC823" | sudo apt-key add
sudo apt-get update
sudo apt-get install -y sbt
sudo apt-get install -y texinfo gengetopt
sudo apt-get install -y libexpat1-dev libusb-dev libncurses5-dev cmake
# deps for poky
sudo apt-get install -y python3.6 patch diffstat texi2html texinfo subversion chrpath git wget
# deps for qemu
sudo apt-get install -y libgtk-3-dev gettext
# deps for firemarshal
sudo apt-get install -y python3-pip python3.6-dev rsync libguestfs-tools expat ctags
# install DTC
sudo apt-get install -y device-tree-compiler

# install verilator
git clone http://git.veripool.org/git/verilator
cd verilator
git checkout v4.034
autoconf && ./configure && make -j$(nproc) && sudo make install

```

由于curl一直以来的玄学问题，第9行前我加了sudo：

```shell
sudo curl -sL "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x2EE0EA64E40A89B84B2DF73499E82A75642AC823" | sudo apt-key add
```

